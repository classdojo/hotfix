// Generated by CoffeeScript 1.4.0
(function() {
  var fs, publish, pubnub;

  fs = require("fs");

  pubnub = require("pubnub");

  exports.require = ["celeri"];

  exports.plugin = function(celeri) {
    return celeri.option({
      command: "push-changes",
      description: "Pushes changes to all clients that are currently viewing the site",
      optional: {
        "config": "Configuration file for pubnub.",
        "critical": "Critical update - user account is force refreshed.",
        "message": "Message to display to the client."
      },
      defaults: {
        "config": "/usr/local/etc/hotfix/config.json",
        "critical": false
      }
    }, publish);
  };

  publish = function(data) {
    var config, pubNubClient;
    console.log("refreshing all connected clients");
    config = require(data.config);
    pubNubClient = pubnub.init(config.pubnub);
    return pubNubClient.publish({
      channel: "hotfix_refresh",
      message: {
        critical: data.critical
      }
    });
  };

}).call(this);
